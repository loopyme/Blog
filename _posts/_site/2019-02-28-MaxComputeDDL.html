<h1 id="a-建表">A. 建表</h1>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="p">[</span><span class="n">if</span> <span class="k">not</span> <span class="k">exists</span><span class="p">]</span> <span class="k">table_name</span>
  <span class="p">[(</span><span class="n">col_name</span> <span class="n">data_type</span> <span class="p">[</span><span class="k">comment</span> <span class="n">col_comment</span><span class="p">],...)]</span>
  <span class="p">[</span><span class="k">comment</span> <span class="n">table_comment</span><span class="p">]</span>
  <span class="p">[</span><span class="n">partitioned</span> <span class="k">by</span> <span class="p">(</span><span class="n">col_name</span> <span class="n">data_type</span> <span class="p">[</span><span class="k">comment</span> <span class="n">col_comment</span><span class="p">],...)]</span>
  <span class="p">[</span><span class="n">lifecycle</span> <span class="n">days</span><span class="p">]</span>
  <span class="p">[</span><span class="k">as</span> <span class="n">select_statement</span><span class="p">]</span>
</code></pre></div></div>

<ol>
  <li>
    <p>大体和sql-ddl类似,其中有一点不同的是:分区列在分区声明位置(第三行)声明,而不应该出现表的字段定义(第二行)中</p>
  </li>
  <li>建议: 不使用[if not exists].这是为了防止出现错误而不报错.所有操作都应确保操作者完全掌握数据库内容.所以删表时加上[if exists]是合适的.若在建表时出现重复定义(即表名重复):
    <ul>
      <li>若使用了[if not exists],会跳过建表这一段继续向下执行,而不停止或报错.这容易使操作者误以为操作成功</li>
      <li>若未使用[if not exists],会停止执行,并报错</li>
    </ul>
  </li>
  <li>delete &amp; rename
    <ul>
      <li>delete : <code class="highlighter-rouge">drop table [if exists] table_name;</code></li>
      <li>rename : <code class="highlighter-rouge">alter table table_name rename to new_table_name;</code></li>
    </ul>
  </li>
  <li>生命周期
    <ul>
      <li>单位:天</li>
      <li>类型:正整数</li>
      <li>只能指定表,而不能是分区</li>
      <li>分区表与非分区表的</li>
    </ul>
    <ul>
      <li>非分区表:自最后一次数据被修改时刻开始计时</li>
      <li>分区表:分别判断每个分区是否应该被回收,但即使所有分区都被回收,表也不会被删除
     - 不指定就不回收</li>
    </ul>
  </li>
  <li>快捷建表 CTAS
    <ul>
      <li>Like方法 : <code class="highlighter-rouge">create table &lt;table_name&gt; as select &lt;column_list&gt; from &lt;table_name&gt; where...;</code></li>
      <li>As方法 :  <code class="highlighter-rouge">create table &lt;tanle_name&gt; like &lt;table_name&gt;;</code></li>
    </ul>
  </li>
</ol>

<p>区别:</p>

<table>
  <thead>
    <tr>
      <th>方法</th>
      <th>带入数据</th>
      <th>复制结构</th>
      <th>带入LifeCycle</th>
      <th>带入分区键信息,注释等</th>
      <th>来源</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>as</td>
      <td>✓</td>
      <td>✓</td>
      <td> </td>
      <td> </td>
      <td>可以依赖多张表</td>
    </tr>
    <tr>
      <td>like</td>
      <td> </td>
      <td>✓</td>
      <td> </td>
      <td>✓</td>
      <td>只能复制单张表的结构</td>
    </tr>
  </tbody>
</table>

<h1 id="b-分区">B. 分区</h1>
<ul>
  <li>添加分区 : <code class="highlighter-rouge">alter table table_name add [if not exists] partition partition_spec;</code></li>
  <li>删除分区<code class="highlighter-rouge">alter table table_name drop [if exists] partition_spec;</code></li>
  <li>其中:<code class="highlighter-rouge">partition_spec:(partition_col1 = partition_col_value1,partition_col2 = partition_col_value2,...)</code></li>
  <li>最高有六个不同的分区键</li>
</ul>

<h1 id="c-修改表属性">C. 修改表属性</h1>
<ul>
  <li>添加列 : <code class="highlighter-rouge">alter table table_name add columns (col_name type1, col_name2 type2);</code></li>
  <li>改列名 : <code class="highlighter-rouge">alter table table_name change column old_col_name rename to new_col_name;</code></li>
  <li>表注释 : <code class="highlighter-rouge">alter table table_name set comment 'tbl comment';</code></li>
  <li>列注释 : <code class="highlighter-rouge">alter table table_name change column col_name comment 'comment';</code></li>
  <li>生命周期 : <code class="highlighter-rouge">alter table table_name set lifecycle days;</code></li>
  <li>修改时间 : <code class="highlighter-rouge">alter table table_name touch [partition(partition_col='partition_col_value',...)];</code></li>
</ul>

<h1 id="d-视图">D. 视图</h1>
<ul>
  <li>创建视图:
    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="p">[</span><span class="k">or</span> <span class="k">replace</span><span class="p">]</span> <span class="k">view</span> <span class="p">[</span><span class="n">if</span> <span class="k">not</span> <span class="k">exists</span><span class="p">]</span> <span class="n">view_name</span>
  <span class="p">[(</span><span class="n">col_name</span><span class="p">[</span><span class="k">COMMENT</span> <span class="n">col_comment</span><span class="p">],...)]</span>
  <span class="p">[</span><span class="k">COMMENT</span> <span class="n">view_comment</span><span class="p">]</span>
  <span class="p">[</span><span class="k">AS</span> <span class="n">select_statement</span><span class="p">]</span>
</code></pre></div>    </div>
  </li>
  <li>删除视图:<code class="highlighter-rouge">drop view[if not exists] view_name;</code></li>
  <li>重命名视图:<code class="highlighter-rouge">alter view view_name rename to new_view_name;</code></li>
</ul>
